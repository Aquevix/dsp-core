<div class="panel panel-default">
    <!-- Default panel contents -->
    <div class="panel-heading resource-header"><strong>Manage Schema</strong>
    </div>
    <table id="resource-container">
        <tr>
            <td id="schema-list">

                <accordion close-others=true>

                    <accordion-group heading="{{service.api_name}}" ng-repeat="service in dbServices">
                        <div class="form-inline">
                            <input type="text" class="form-control"  placeholder="New table name" data-ng-model="newTableName"/>
                            <button ng-click="createTable()" class="btn btn-default">
                                Create
                            </button>
                        </div>
                        <br/>
                        <ul id="resource-list" class="list-group">
                            <li ng-click="showDetails()"  class="list-group-item"
                                ng-repeat="table in service.tables">
                                <span data-ng-click="loadSchema()" class="user-name">{{table.name}}</span>
            <span class="btn-group btn-group-sm pull-right">

                                      <button class="btn btn-default" title="Show JSON Schema"
                                              ng-click="loadSchema(true)"><i class="fa fa-code"></i>
                                      </button>
                <button class="btn btn-danger" title="Drop Table"
                        ng-click="dropTable()"><i
                        class="fa fa-trash-o"></i>
                </button>
            </span>


                            </li>
                        </ul>

                    </accordion-group>

                </accordion>


            </td>


            <td>&nbsp;</td>
            <td id="app-details">
                <div data-ng-show="advanced">
                    <div id="schema-editor"></div>
                <br/>
                    <div class="btn-group"><button class="btn btn-default"  data-ng-show="table.schema" data-ng-click="toggleJSON()">Toggle JSON</button><button class="btn btn-primary" data-ng-click="updateJSONSchema()">Update Schema</button></div>

                </div>
                <div data-ng-show="!advanced">
                    <accordion close-others=true>

                        <accordion-group ng-repeat="column in table.schema.data.field">
                            <accordion-heading>{{column.name}} <span class="btn-group btn-group-sm pull-right">

                                      <button class="btn btn-default" title="Delete Column"
                                              ng-click="deleteColumn()"><i
                                              class="fa fa-trash-o"></i>
                                      </button>
            </span></accordion-heading>
                                    <div class="form-group">
                                        <label>Name</label>
                                        <input class="form-control" type="text" data-ng-model = "column.name"/>
                                        <br/>
                                        <label>Label</label>
                                        <input class="form-control" type="text" data-ng-model = "column.label"/>
                                        <br/>
                                        <label>Type&nbsp;&nbsp;</label><span class="text-muted">This is a simplified DreamFactory Type</span>
                                        <select data-ng-options = "type.value as type.value for type in typeOptions " class="form-control" data-ng-model = "column.type"></select>
                                        <br/>
                                        <label>Database Type</label>
                                        <input class="form-control" type="text" data-ng-model = "column.db_type"/>
                                        <br/>
                                        <label>Length</label>
                                        <input class="form-control" type="text" data-ng-model = "column.length"/>
                                        <br/>
                                        <label>Fixed Length</label>
                                        <input class="form-control" type="text" data-ng-disabled ="column.type !== 'string'" data-ng-model = "column.fixed_length"/>
                                        <br/>
                                        <label>Allow Null?</label>
                                        <input class="form-control" type="text" data-ng-model = "column.allow_null"/>
                                        <br/>
                                        <label>Primary Key?</label>
                                        <input class="form-control" type="text" data-ng-model = "column.is_primary_key"/>
                                        <br/>
                                        <label>Auto Increment</label>
                                        <input class="form-control" type="text" data-ng-model = "column.auto_increment"/>
                                        <br/>
                                        <label>Foreign Key?</label>
                                        <input class="form-control" type="text" data-ng-model = "column.is_foreign_key"/>
                                        <br/>

                                        <label>Default Value</label>
                                        <input class="form-control" type="text" data-ng-model = "column.default"/>
                                        <br/>
                                        <label>Precision</label>
                                        <input class="form-control" type="text" data-ng-model = "column.precision"/>
                                        <br/>
                                        <label>Scale</label>
                                        <input class="form-control" type="text" data-ng-model = "column.scale"/>
                                        <br/>
                                        <label>Reference Fields</label>
                                        <input class="form-control" type="text" data-ng-model = "column.ref_fields"/>
                                        <br/>
                                        <label>Reference Table</label>
                                        <input class="form-control" type="text" data-ng-model = "column.ref_tables"/>
                                        <br/>
                                        <label>Required</label>
                                        <input class="form-control" type="text" data-ng-disabled =true data-ng-model = "column.required"/>
                                        <br/>
                                        <label>Supports Multibyte</label>
                                        <input class="form-control" type="text" data-ng-disabled ="column.type !== 'string'" data-ng-model = "column.supports_multibyte"/>
                                        <br/>

                                        <label>Validation</label>
                                        <input class="form-control" type="text" data-ng-model = "column.validation"/>
                                        <br/>
                                        <div data-ng-show="column.type === 'string' || column.type === 'integer'">
                                            <label>Value</label>&nbsp;&nbsp;<span class="text-muted">Enter a comma delimited list of values</span>
                                            <input class="form-control" type="text" data-ng-model = "column.value"/>
                                            <br/>
                                        </div>

                                    </div>



                        </accordion-group>

                    </accordion>
                    <br/>
                    <div class="btn-group">
                        <button class="btn btn-default"  data-ng-show="table.schema" data-ng-click="toggleJSON()">Toggle JSON</button><button class="btn btn-default" data-ng-show="table.schema" data-ng-click="addColumn()">Add Column</button><button class="btn btn-primary" data-ng-show="table.schema" data-ng-click="updateSchema()">Update Schema</button>
                </div>

                </div>

                <div>

                    <div id="create-form" data-ng-show="createBasic">
                        <div class="alert alert-info">
                            <li class="icon-info-sign"></li>
                            &nbsp;Propose table structure and click "Create Table" to save.
                        </div>
                        <div class="section">
                            <span>Table Name:</span><input id="table-name" type="text" ng-model="schema.table.name"/>
                        </div>

                        <div class="alert alert-info">
                            <li class="icon-info-sign"></li>
                            &nbsp;Add fields
                        </div>

                        <div class="section">
                            <span>Field Name:</span><input ng-disabled="!schema.table.name" type="text"
                                                           ng-model="schema.table.field.name"/>
                            <br/>
                            <span>Field Type:</span><select ng-disabled="!schema.table.name || !schema.table.field.name"
                                                            ng-model="schema.table.field.type">
                            <option value="id">ID / Primary Key</option>
                            <option value="string">String</option>
                            <option value="integer">Integer</option>
                            <option value="text">Text</option>
                            <option value="boolean">Boolean</option>
                            <option value="binary">Binary</option>
                            <option value="float">Float</option>
                            <option value="decimal">Decimal</option>
                            <option value="datetime">Datetime</option>
                            <option value="date">Date</option>
                            <option value="time">Time</option>


                        </select>
                            <br/>
                            <span>Field Size:</span><input
                                ng-disabled="!schema.table.name || !schema.table.field.name || !schema.table.field.type"
                                type="text" ng-model="schema.table.field.size"/>
                            <br/>
                            <span>Allow Null:</span><input
                                ng-disabled="!schema.table.name || !schema.table.field.name || !schema.table.field.type"
                                type="checkbox" ng-model="schema.table.field.allow_null"/><br/>

                            <div>
                                <button ng-disabled="!schema.table.name || !schema.table.field.name || !schema.table.field.type"
                                        class="btn btn-success" ng-click="addField()">
                                    <li class="icon-plus-sign-alt"></li>
                                    &nbsp;Add Field
                                </button>
                            </div>
                        </div>


                        <div id="fields_container"></div>
                        <table id="field-list" class="table table-hover table-striped">

                            <tbody>

                            <tr ng-repeat="field in newTable.table.field">
                                <td>{{field.name}}</td>
                                <td>{{field.type}}</td>
                                <td>{{field.size}}</td>
                                <td>{{field.allow_null}}</td>
                                <td class="no-border">
                                    <div class="btn-group">

                                        <button class="btn btn-default" ng-click="removeField()"><i
                                                class="fa fa-trash-o"></i></button>

                                    </div>
                                </td>
                            </tr>

                            </tbody>
                        </table>
                        <div>
                            <button ng-disabled="!newTable.table.field.length" class="btn btn-primary"
                                    ng-click="create()">
                                <li class="icon-save"></li>
                                &nbsp;Create Table
                            </button>
                        </div>
                    </div>


                    <div id="json_upload" style="display:none;">
                        <style>
                            body {
                                font-family: sans-serif;
                            }

                            #result {
                                padding: 1em;
                            }

                            .pass {
                                background-color: #efe;
                                color: #393;
                                border: 2px solid #393;
                            }

                            .fail {
                                background-color: #fee;
                                color: #933;
                                border: 2px solid #933;
                            }

                            textarea {
                                width: 100%;
                            }
                        </style>


                        <div class="alert alert-info">Paste your JSON Schema below, Click Validate to use JSONlint
                            before creating.
                        </div>

                        <textarea id="source" rows="20" cols="50"></textarea>

                        <div style="white-space: nowrap" class="form-inline">
                            <button ng-click="validateJSON()" id="button">Validate</button>
                            &nbsp;<input type="checkbox" value="yes" id="reformat"/>
                            <label for="reformat">Reformat JSON?</label>
                        </div>
                        <h2>Results</h2>
                        <pre id="result"></pre>
                        <p>
                            <button class="btn btn-primary" ng-click="postJSON()" class="icon-save"> Create Table(s)
                            </button>
                        </p>
                    </div>

                </div>
            </td>
        </tr>
    </table>
</div>
